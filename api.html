<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TopScore AI - Developer Guide</title>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --text: #1e293b;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            min-height: 100vh;
        }

        header {
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--primary);
            margin: 0;
        }

        h2 {
            margin-top: 2.5rem;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        h3 {
            color: #475569;
            margin-top: 1.5rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            background: #dbeafe;
            color: #1e40af;
        }

        code {
            background: #f1f5f9;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
            color: #d946ef;
        }

        pre {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            position: relative;
        }

        .endpoint {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            margin: 1rem 0;
        }

        .method {
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            color: white;
        }

        .get {
            background: #059669;
        }

        .post {
            background: #2563eb;
        }

        .ws {
            background: #7c3aed;
        }

        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            border-radius: 0.5rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        .btn:hover {
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th,
        td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f8fafc;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üéì TopScore AI Developer Guide</h1>
            <p>Complete documentation for integrating with the TutorAgent Backend.</p>
            <div style="margin-top: 1rem;">
                <a href="/docs" class="btn">Interactive Swagger UI</a>
                <a href="/redoc" class="btn" style="background: #475569; margin-left: 1rem;">ReDoc Reference</a>
            </div>
        </header>

        <section id="connection">
            <h2>üîå connecting to the Agent</h2>
            <p>The frontend communicates with the agent primarily through <strong>WebSockets</strong> for real-time
                chat, and <strong>REST APIs</strong> for state management (profile, history, knowledge).</p>

            <div class="endpoint">
                <span class="method ws">WS</span>
                <code>/ws/chat</code>
                <span>Real-time bidirectional chat stream</span>
            </div>

            <h3>1. WebSocket Protocol</h3>
            <p>Connect to the WebSocket endpoint to start a session. The protocol is event-driven.</p>

            <h4>Client Sends:</h4>
            <pre><code>{
  "user_id": "student_123",
  "thread_id": "session_abc",
  "message": "Explain photosynthesis",
  "model_preference": "fast"  // or "smart"
}</code></pre>

            <h4>Server Responds (Stream):</h4>
            <p>The server streams JSON events back to the client.</p>
            <table>
                <tr>
                    <th>Event Type</th>
                    <th>Structure</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>token</code></td>
                    <td><code>{"type": "token", "content": "The..."}</code></td>
                    <td>Real-time text chunk for streaming responses.</td>
                </tr>
                <tr>
                    <td><code>status</code></td>
                    <td><code>{"type": "status", "content": "Thinking..."}</code></td>
                    <td>Agent state updates (Planning, Reflecting, etc.).</td>
                </tr>
                <tr>
                    <td><code>image</code></td>
                    <td><code>{"type": "image", "content": "base64..."}</code></td>
                    <td>Generated image data.</td>
                </tr>
                <tr>
                    <td><code>end_turn</code></td>
                    <td><code>{"type": "end_turn"}</code></td>
                    <td>Signals the completion of the current response.</td>
                </tr>
            </table>

            <h3>2. JavaScript Integration Example</h3>
            <pre><code class="language-javascript">const ws = new WebSocket("ws://localhost:8080/ws/chat");

ws.onopen = () => {
    // Send initial message
    ws.send(JSON.stringify({
        user_id: "user_1",
        thread_id: "thread_1",
        message: "Hello!"
    }));
};

ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    
    if (data.type === "token") {
        updateChatUI(data.content); // Append text
    } else if (data.type === "status") {
        showStatusIndicator(data.content);
    } else if (data.type === "end_turn") {
        enableInput(); // Ready for next user message
    }
};</code></pre>
        </section>

        <section id="rest-api">
            <h2>üõ†Ô∏è REST API Endpoints</h2>
            <p>Use these endpoints for non-streaming operations.</p>

            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/chat</code>
                <span>Alternative to WebSocket (Server-Sent Events)</span>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/threads/{user_id}</code>
                <span>List conversation history</span>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <code>/profile/{user_id}</code>
                <span>Get learning profile & stats</span>
            </div>

            <div class="endpoint">
                <span class="method post">POST</span>
                <code>/knowledge/upload</code>
                <span>Upload PDFs/Text to knowledge base</span>
            </div>
        </section>

        <section id="multilingual">
            <h2>üåç Multilingual Support</h2>
            <p>The API automatically handles language detection.</p>
            <ul>
                <li><strong>English (en):</strong> Default for Science, Math, General topics.</li>
                <li><strong>Kiswahili (sw):</strong> Automatically activated for Swahili subjects (Grammar,
                    Literature/Fasihi).</li>
            </ul>
            <p>No special flags are needed; the agent detects intent from the message content.</p>
        </section>
    </div>
</body>

</html>